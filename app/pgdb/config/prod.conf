# ============================================================
# Prod config: ~4 vCPU, 16 GiB RAM
# ============================================================

# System
timezone                        = 'UTC'

# Connection
listen_addresses                = '*'      
port                            = 5432
ssl                             = off
max_connections                 = 350       # (pool_size+max_overflow) * workers * instance

# Memory settings
shared_buffers                  = '1GB'      # ~25% of RAM
effective_cache_size            = '3GB'      # planner hint (~75% of RAM)
work_mem                        = '4MB'      # per sort/hash operation (watch concurrent queries)
maintenance_work_mem            = '256MB'    # VACUUM, CREATE INDEX, etc.

# WAL / checkpoints
max_wal_size                    = '8GB'
min_wal_size                    = '1GB'
checkpoint_timeout              = '15min'
checkpoint_completion_target    = 0.9
wal_buffers                     = 16MB
wal_compression                 = on

# Autovacuum
autovacuum_vacuum_scale_factor  = 0.05
autovacuum_analyze_scale_factor = 0.05

# Extensions: pg_stat_statements
shared_preload_libraries        = 'pg_stat_statements'
# pg_stat_statements tuning
pg_stat_statements.max          = 20000     # track more distinct statements in prod
pg_stat_statements.track        = 'all'
pg_stat_statements.save         = on

# Logging / diagnostics
log_min_duration_statement      = '200ms'   # log queries slower than 200ms
log_checkpoints                 = on
log_autovacuum_min_duration     = '500ms'   # log autovacuum runs > 0.5s

# Track I/O timing for deeper performance analysis
track_io_timing                 = on
track_wal_io_timing             = on

synchronous_commit = off